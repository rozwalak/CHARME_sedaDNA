pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.005, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
c.poly <- c(rep("#00A087FF", times=43), rep("#3C548899", times=4))
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
c.poly <- c(rep("#00A087FF", times=43), rep("#3C548899", times=4))
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.005, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
Marian.rioja <- Marian %>%
arrange(Age) %>%
select(where(~ any(. != 0))) %>%
select(-DNA_ID,-Age,-Site)
y.scale <- c(1972,
1976,
1984,
1995,
1999,
2001,
2005,
2011,
2015,
2017)
y.tks <- c(1972:2017)
matrix_marian <- as.matrix(read_excel("input/rioja_matrix_marian.xlsx", col_names = FALSE))
c.poly <- c(rep("#22BB3B", times=39), rep("#3C548877", times=4))
ma.dist <- vegdist(Marian.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Marian.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, title = "Marian Cove", ylabel = "Age",
srt.xlabel=40, clust=ma.chclust, ylabPos=3, minmax = matrix_marian)
Marian_rioja <- addClustZone(pol.plot, ma.chclust, nZone=3, lwd=1.5, lty=2, col="grey25")
matrix_marian <- as.matrix(read_excel("input/rioja_matrix_marian.xlsx", col_names = FALSE))
c.poly <- c(rep("#00A087FF", times=39), rep("#3C548877", times=4))
ma.dist <- vegdist(Marian.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Marian.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, title = "Marian Cove", ylabel = "Age",
srt.xlabel=40, clust=ma.chclust, ylabPos=3, minmax = matrix_marian)
Marian_rioja <- addClustZone(pol.plot, ma.chclust, nZone=3, lwd=1.5, lty=2, col="grey25")
matrix_marian <- as.matrix(read_excel("input/rioja_matrix_marian.xlsx", col_names = FALSE))
c.poly <- c(rep("#00A087FF", times=39), rep("#3C548877", times=4))
ma.dist <- vegdist(Marian.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Marian.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, title = "Marian Cove", ylabel = "Age",
srt.xlabel=40, clust=ma.chclust, ylabPos=3, minmax = matrix_marian)
Marian_rioja <- addClustZone(pol.plot, ma.chclust, nZone=3, lwd=1.5, lty=2, col="grey25")
matrix_marian <- as.matrix(read_excel("input/rioja_matrix_marian.xlsx", col_names = FALSE))
c.poly <- c(rep("#00A087FF", times=39), rep("#3C548877", times=4))
ma.dist <- vegdist(Marian.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Marian.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, title = "Marian Cove", ylabel = "Age",
srt.xlabel=40, clust=ma.chclust, ylabPos=3, minmax = matrix_marian)
Marian_rioja <- addClustZone(pol.plot, ma.chclust, nZone=3, lwd=1.5, lty=2, col="grey25")
Borgen.rioja <- Borgen %>%
arrange(Age) %>%
select(where(~ any(. != 0))) %>%
select(-DNA_ID,-Age,-Site)
y.scale <- c(1965,
1966,
1967.2,
1967.8,
1968.4,
1968.7,
1969,
1969.3,
1974,
1990,
1998,
2014)
y.tks <- c(1965:2014)
c.poly <- c(rep("#00A087FF", times=36), rep("#3C548877", times=4))
matrix_borgen <- as.matrix(read_excel("input/rioja_matrix_borgen.xlsx", col_names = FALSE))
ma.dist <- vegdist(Borgen.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Borgen.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, title = "Borgen Bay", ylabel = "Age",
srt.xlabel=40, clust=ma.chclust, ylabPos=3, minmax = matrix_borgen)
Borgen_rioja <- addClustZone(pol.plot, ma.chclust, nZone=2, lwd=1.5, lty=2, col="grey25")
Borgen_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
pol.plot <- strat.plot(Borgen.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, title = "Borgen Bay", ylabel = "Age",
srt.xlabel=40, clust=ma.chclust, ylabPos=3, minmax = matrix_borgen)
Sheldon.rioja <- Sheldon %>%
arrange(Age) %>%
select(-DNA_ID,-Age,-Site) %>%
select(where(~ any(. != 0)))
y.scale <- c(1948,
1950,
1953,
1956,
1958,
1961,
1964,
1967,
1970,
1972,
1973,
1975,
1979,
1986,
1993,
2000,
2007,
2014)
y.tks <- c(1948:2014)
c.poly <- c(rep("#00A087FF", times=43), rep("#3C548899", times=4))
matrix_sheldon <- as.matrix(read_excel("input/rioja_matrix_sheldon.xlsx", col_names = FALSE))
ma.dist <- vegdist(Sheldon.rioja, method="bray", binary=FALSE, diag=FALSE, upper=FALSE, na.rm = FALSE)
ma.chclust <- chclust(ma.dist, method="coniss")
pol.plot <- strat.plot(Sheldon.rioja, yvar=y.scale, y.tks=y.scale, y.rev=FALSE, plot.line=TRUE, plot.poly=TRUE, plot.bar=FALSE, col.poly = c.poly, lwd.bar=0.001, scale.percent=FALSE, xSpace=0.006, x.pc.lab=TRUE, x.pc.omit0=TRUE, las=2, ylabel = "Age",
srt.xlabel=50, clust=ma.chclust, ylabPos=3, cex.xlabel =  1.3, minmax = matrix_sheldon)
Sheldon_rioja <- addClustZone(pol.plot, ma.chclust, nZone=4, lwd=1.5, lty=2, col="grey25")
library(vegan)
library(rioja)
library(readxl)
library(writexl)
library(funrar)
library(tidyverse)
library(analogue)
library(janitor)
library(svglite)
library(viridis)
#read dataframe
df <- read_excel("input/ATP23-012_Analiza.xlsx", sheet = "Analiza-merged")
#read dataframe
df <- read_excel("input/ATP23-012_Analiza.xlsx", sheet = "Analiza-merged")
#metadata
meta <- read_excel("input/ATP23-012_Analiza.xlsx", sheet = "Metadata")
ages <- read_excel("input/Dating_biomarkers.xlsx")
metadata <- merge(meta, ages) %>%
select(DNA_ID, Age, Site)
#taxonomy dataframe
taxo <- df %>%
separate(Taxon, c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species")) %>%
select(1:8)
#only numbers about abundance
matrix <- df %>% select(1, 3:51) %>%
column_to_rownames(var="#ASV ID")
#relative abundance of matrix
matrix_t <- t(matrix)
rel_abundance <- make_relative(matrix_t)
rel_abundance <- t(rel_abundance)
rel_abundance <- data.frame(rel_abundance) %>%
mutate(Total = rowSums(.)) %>%
rownames_to_column("#ASV ID") %>%
inner_join(taxo)
rel_abundance <- data.frame(t(rel_abundance)) %>%
row_to_names(row_number = 1) %>%
rownames_to_column("DNA_ID") %>%
merge(metadata)
rel_abundance[2:3562] <- sapply(rel_abundance[2:3562],as.numeric)
rel_abundance <- rel_abundance %>%
arrange(Age) %>%
select(where(~ any(. != 0)))
#make community matrix - extract columns with abundance information
com = rel_abundance[,2:2514]
#turn abundance data frame into a matrix
m_com = as.matrix(com)
#calculate nMDS
set.seed(123)
nmds = metaMDS(m_com, distance = "bray")
nmds = metaMDS(m_com, distance = "bray")
#turn abundance data frame into a matrix
m_com = as.matrix(com)
View(m_com)
View(rel_abundance)
rel_abundance <- data.frame(t(rel_abundance)) %>%
row_to_names(row_number = 1) %>%
rownames_to_column("DNA_ID") %>%
merge(metadata)
#read dataframe
df <- read_excel("input/ATP23-012_Analiza.xlsx", sheet = "Analiza-merged")
#metadata
meta <- read_excel("input/ATP23-012_Analiza.xlsx", sheet = "Metadata")
ages <- read_excel("input/Dating_biomarkers.xlsx")
metadata <- merge(meta, ages) %>%
select(DNA_ID, Age, Site)
#taxonomy dataframe
taxo <- df %>%
separate(Taxon, c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species")) %>%
select(1:8)
#only numbers about abundance
matrix <- df %>% select(1, 3:51) %>%
column_to_rownames(var="#ASV ID")
#relative abundance of matrix
matrix_t <- t(matrix)
rel_abundance <- make_relative(matrix_t)
rel_abundance <- t(rel_abundance)
rel_abundance <- data.frame(rel_abundance) %>%
mutate(Total = rowSums(.)) %>%
rownames_to_column("#ASV ID") %>%
inner_join(taxo)
rel_abundance <- data.frame(t(rel_abundance)) %>%
row_to_names(row_number = 1) %>%
rownames_to_column("DNA_ID") %>%
merge(metadata)
View(rel_abundance)
rel_abundance[2:3724] <- sapply(rel_abundance[2:3724],as.numeric)
rel_abundance <- rel_abundance %>%
arrange(Age) %>%
select(where(~ any(. != 0)))
View(rel_abundance)
#make community matrix - extract columns with abundance information
com = rel_abundance[,2:2548]
#turn abundance data frame into a matrix
m_com = as.matrix(com)
#calculate nMDS
set.seed(123)
nmds = metaMDS(m_com, distance = "bray")
nmds
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds)$sites)
#add columns to data frame
data.scores$Site = rel_abundance$Site
data.scores$Age = rel_abundance$Age
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Site", y = "NMDS2", shape = "Type") +
scale_color_viridis(discrete = FALSE)
nmds_plot
View(data.scores)
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Type") +
scale_color_viridis(discrete = FALSE)
nmds_plot
stressplot(nmds)
nmds_plot
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE)
nmds_plot
View(data.scores)
#read dataframe
df <- read_excel("input/ATP23-012_Analiza.xlsx", sheet = "Analiza-merged")
#metadata
meta <- read_excel("input/ATP23-012_Analiza.xlsx", sheet = "Metadata")
ages <- read_excel("input/Dating_biomarkers.xlsx")
metadata <- merge(meta, ages) %>%
select(DNA_ID, Age, Site)
#taxonomy dataframe
taxo <- df %>%
separate(Taxon, c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species")) %>%
select(1:8)
#only numbers about abundance
matrix <- df %>% select(1, 3:51) %>%
column_to_rownames(var="#ASV ID")
#relative abundance of matrix
matrix_t <- t(matrix)
rel_abundance <- make_relative(matrix_t)
rel_abundance <- t(rel_abundance)
rel_abundance <- data.frame(rel_abundance) %>%
mutate(Total = rowSums(.)) %>%
rownames_to_column("#ASV ID") %>%
inner_join(taxo)
rel_abundance <- data.frame(t(rel_abundance)) %>%
row_to_names(row_number = 1) %>%
rownames_to_column("DNA_ID") %>%
merge(metadata)
rel_abundance[2:3724] <- sapply(rel_abundance[2:3724],as.numeric)
rel_abundance <- rel_abundance %>%
arrange(Age) %>%
select(where(~ any(. != 0)))
#make community matrix - extract columns with abundance information
com = rel_abundance[,2:2548]
#turn abundance data frame into a matrix
m_com = as.matrix(com)
#calculate nMDS
set.seed(123)
nmds = metaMDS(m_com, distance = "bray")
nmds
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds)$sites)
#add columns to data frame
data.scores$Site = rel_abundance$Site
data.scores$Age = rel_abundance$Age
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE)
nmds_plot
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Site), size = 4, vjust = 1.5)
nmds_plot
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Age), size = 4, vjust = 1.5)
nmds_plot
nmds = metaMDS(m_com, distance = "bray", autotransform =TRUE)
nmds
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds)$sites)
#add columns to data frame
data.scores$Site = rel_abundance$Site
data.scores$Age = rel_abundance$Age
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Age), size = 4, vjust = 1.5)
nmds_plot
nmds = metaMDS(m_com, distance = "euclidean")
nmds
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds)$sites)
#add columns to data frame
data.scores$Site = rel_abundance$Site
data.scores$Age = rel_abundance$Age
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Age), size = 4, vjust = 1.5)
nmds_plot
stressplot(nmds)
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Age), size = 4, vjust = 1.5)
nmds_plot
nmds = metaMDS(m_com, distance = "jaccard")
nmds
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds)$sites)
#add columns to data frame
data.scores$Site = rel_abundance$Site
data.scores$Age = rel_abundance$Age
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Age), size = 4, vjust = 1.5)
nmds_plot
nmds = metaMDS(m_com, distance = "chao")
nmds
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds)$sites)
#add columns to data frame
data.scores$Site = rel_abundance$Site
data.scores$Age = rel_abundance$Age
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Age), size = 4, vjust = 1.5)
nmds_plot
nmds = metaMDS(m_com, distance = "bray")
nmds
#extract NMDS scores (x and y coordinates)
data.scores = as.data.frame(scores(nmds)$sites)
#add columns to data frame
data.scores$Site = rel_abundance$Site
data.scores$Age = rel_abundance$Age
nmds_plot = ggplot(data.scores, aes(x = NMDS1, y = NMDS2)) +
geom_point(size = 6, aes(colour = Age, shape = Site))+
theme(axis.text.y = element_text(colour = "black", size = 12, face = "bold"),
axis.text.x = element_text(colour = "black", face = "bold", size = 12),
legend.text = element_text(size = 12, face ="bold", colour ="black"),
legend.position = "right", axis.title.y = element_text(face = "bold", size = 14),
axis.title.x = element_text(face = "bold", size = 14, colour = "black"),
legend.title = element_text(size = 14, colour = "black", face = "bold"),
panel.background = element_blank(), panel.border = element_rect(colour = "black", fill = NA, linewidth = 1.2),
legend.key=element_blank()) +
labs(x = "NMDS1", colour = "Age", y = "NMDS2", shape = "Site") +
scale_color_viridis(discrete = FALSE) +
geom_text(aes(label = Age), size = 4, vjust = 1.5)
nmds_plot
View(data.scores)
